{% extends "base.html" %}
{% block title %}Stats - LL Trivia{% endblock %}

{% block content %}
<h1>Study Statistics</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ total_questions }}</div>
        <div class="stat-label">Total Questions</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ total_studied }}</div>
        <div class="stat-label">Studied</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ overall_accuracy }}%</div>
        <div class="stat-label">Overall Accuracy</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ due_count }}</div>
        <div class="stat-label">Due for Review</div>
    </div>
</div>

{% if confidence_data %}
<h2>Confidence Distribution</h2>
<div class="confidence-bars">
    {% for item in confidence_data %}
    <div class="conf-bar-group">
        <span class="conf-label">{{ item.label }}</span>
        <div class="conf-bar-wrap">
            <div class="conf-bar conf-{{ item.label|lower }}" style="width: {{ (item.count / total_studied * 100)|int if total_studied > 0 else 0 }}%">
                {{ item.count }}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if category_stats %}
<h2>Accuracy by Category</h2>
<table class="data-table">
    <thead>
        <tr>
            <th>Category</th>
            <th>Total</th>
            <th>Studied</th>
            <th>Accuracy</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for c in category_stats %}
        <tr>
            <td>{{ c.category }}</td>
            <td>{{ c.total }}</td>
            <td>{{ c.studied }}</td>
            <td>{{ c.accuracy }}%</td>
            <td>
                <div class="accuracy-bar">
                    <div class="accuracy-fill {% if c.accuracy >= 70 %}good{% elif c.accuracy >= 40 %}ok{% else %}weak{% endif %}"
                         style="width: {{ c.accuracy }}%"></div>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

{% if weakest %}
<h2>Weakest Categories</h2>
<div class="weakest-list">
    {% for c in weakest %}
    <div class="weakest-item">
        <span class="weakest-cat">{{ c.category }}</span>
        <span class="weakest-acc">{{ c.accuracy }}%</span>
        <a href="/study?category={{ c.category }}" class="btn btn-small">Practice</a>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if total_questions == 0 %}
<div class="empty-state">
    <p>No data yet. <a href="/import">Import questions</a> and start studying to see stats.</p>
</div>
{% endif %}
{% endblock %}
